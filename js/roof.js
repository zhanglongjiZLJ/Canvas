$(document).ready(function(){var san_arr_c=[[],[],[],[],[],[],[],[],[],[]],san_arr_r=[[],[],[],[],[],[],[],[],[],[]],ti_arr_c=[[],[],[],[],[],[],[],[],[],[]],ti_arr_r=[[],[],[],[],[],[],[],[],[],[]],ju_arr_c=[[],[],[],[],[],[],[],[],[],[]],ju_arr_r=[[],[],[],[],[],[],[],[],[],[]];var canvas_length=$(".canvas-content").children("canvas").length;$(".add").click(function(){var index=$(this).parents(".roof-item").index();switch(index){case 0:$(this).prevAll(".triangle-checked").prop("checked",true);var html='<div class="triangle type">'+'<input class="triangle-checked" type="checkbox" name="select" id="triangle" value="" checked/><label for="triangle">三角形</label>'+'<input class="roof-input san-xie" type="" name="" id="" value="" placeholder="斜边"/>'+'<input class="roof-input san-di" type="" name="" id="" value="" placeholder="底"/>'+'<img class="reduce" src="img/reduce.svg"/>'+"</div>";$(this).parents(".roof-item").append(html);break;case 1:$(this).prevAll("#trapezoid").prop("checked",true);var html='<div class="trapezoid type">'+'<input type="checkbox" name="select" id="trapezoid" value="" checked/><label for="trapezoid">梯形</label>'+'<input class="roof-input ti-top" type="" name="" id="" value="" placeholder="上底"/>'+'<input class="roof-input ti-bottom" type="" name="" id="" value="" placeholder="下底"/>'+'<input class="roof-input ti-xie" type="" name="" id="" value="" placeholder="斜边"/>'+'<img class="reduce" src="img/reduce.svg"/>'+"</div>";$(this).parents(".roof-item").append(html);break;case 2:$(this).prevAll("#rectangle").prop("checked",true);var html='<div class="rectangle type">'+'<input type="checkbox" name="select" id="rectangle" value="" checked/><label for="rectangle">矩形</label>'+'<input class="roof-input ju-width" type="" name="" id="" value="" placeholder="宽"/>'+'<input class="roof-input ju-height" type="" name="" id="" value="" placeholder="高"/>'+'<img class="reduce" src="img/reduce.svg"/>'+"</div>";$(this).parents(".roof-item").append(html);break;default:break}});$(".roof-content").on("click",".reduce",function(){$(this).parent(".type").remove()});$(".submit").click(function(){san_arr_c=[[],[],[],[],[],[],[],[],[],[]],san_arr_r=[[],[],[],[],[],[],[],[],[],[]],ti_arr_c=[[],[],[],[],[],[],[],[],[],[]],ti_arr_r=[[],[],[],[],[],[],[],[],[],[]],ju_arr_c=[[],[],[],[],[],[],[],[],[],[]],ju_arr_r=[[],[],[],[],[],[],[],[],[],[]];$(".canvas-content").empty();var sun_width=1.65;var sun_height=1.05;var sanjiao_arr=[];var type=[[],[],[]];var fenge_index=0;for(var i=0;i<$(".type").length;i++){if($("input[type='checkbox']").eq(i).prop("checked")&&$("input[type='checkbox']").eq(i).parents(".roof-item").hasClass("roof-item1")){if(i<$(".triangle").length){type[0].push({id:i*2,san_di:$(".triangle").eq(i).children(".san-di").val(),san_xie:$(".triangle").eq(i).children(".san-xie").val()})}}else{if($("input[type='checkbox']").eq(i).prop("checked")&&$("input[type='checkbox']").eq(i).parents(".roof-item").hasClass("roof-item2")){if(i>=$(".triangle").length&&i<($(".triangle").length+$(".trapezoid").length)){if(type[0].length==0){type[1].push({id:(i-1)*2,ti_top:$(".trapezoid").eq(i-$(".triangle").length).children(".ti-top").val(),ti_bottom:$(".trapezoid").eq(i-$(".triangle").length).children(".ti-bottom").val(),ti_xie:$(".trapezoid").eq(i-$(".triangle").length).children(".ti-xie").val()})}else{type[1].push({id:i*2,ti_top:$(".trapezoid").eq(i-$(".triangle").length).children(".ti-top").val(),ti_bottom:$(".trapezoid").eq(i-$(".triangle").length).children(".ti-bottom").val(),ti_xie:$(".trapezoid").eq(i-$(".triangle").length).children(".ti-xie").val()})}}}else{if($("input[type='checkbox']").eq(i).prop("checked")&&$("input[type='checkbox']").eq(i).parents(".roof-item").hasClass("roof-item3")){if(i>=($(".triangle").length+$(".trapezoid").length)){if(type[0].length==0&&type[1].length!=0){type[2].push({id:(i-1)*2,ju_width:$(".rectangle").eq(i-($(".triangle").length+$(".trapezoid").length)).children(".ju-width").val(),ju_height:$(".rectangle").eq(i-($(".triangle").length+$(".trapezoid").length)).children(".ju-height").val()})}else{if(type[1].length==0&&type[0].length!=0){type[2].push({id:(i-1)*2,ju_width:$(".rectangle").eq(i-($(".triangle").length+$(".trapezoid").length)).children(".ju-width").val(),ju_height:$(".rectangle").eq(i-($(".triangle").length+$(".trapezoid").length)).children(".ju-height").val()})}else{if(type[1].length==0&&type[0].length==0){type[2].push({id:(i-2)*2,ju_width:$(".rectangle").eq(i-($(".triangle").length+$(".trapezoid").length)).children(".ju-width").val(),ju_height:$(".rectangle").eq(i-($(".triangle").length+$(".trapezoid").length)).children(".ju-height").val()})}else{type[2].push({id:i*2,ju_width:$(".rectangle").eq(i-($(".triangle").length+$(".trapezoid").length)).children(".ju-width").val(),ju_height:$(".rectangle").eq(i-($(".triangle").length+$(".trapezoid").length)).children(".ju-height").val()})}}}}}}}}for(var i=0;i<type[0].length;i++){if(2*type[0][i].san_xie>type[0][i].san_di&&2*type[0][i].san_di>type[0][i].san_xie&&type[0][i].san_di!=""&&type[0][i].san_xie!=""){create_node();
jisuan_sanjiao(i,type[0][i].san_xie,type[0][i].san_di,sun_width,sun_height)}}for(var i=0;i<type[1].length;i++){if(parseInt(type[1][i].ti_bottom)>parseInt(type[1][i].ti_top)&&parseInt(type[1][i].ti_xie)!=0&&(2*parseInt(type[1][i].ti_xie)+parseInt(type[1][i].ti_top))>parseInt(type[1][i].ti_bottom)){create_node();jisuan_tixing(i,parseInt(type[1][i].ti_top),parseInt(type[1][i].ti_bottom),parseInt(type[1][i].ti_xie),sun_width,sun_height)}}for(var i=0;i<type[2].length;i++){if((type[2][i].ju_width!=0&&type[2][i].ju_height!=0)){create_node();jisuan_juxing(i,parseInt(type[2][i].ju_width),parseInt(type[2][i].ju_height),sun_width,sun_height)}}for(var i=0;i<type[0].length;i++){if(2*type[0][i].san_xie>type[0][i].san_di&&2*type[0][i].san_di>type[0][i].san_xie&&type[0][i].san_di!=""&&type[0][i].san_xie!=""){draw_sanjiao(type[0][i].id,san_arr_r[i],type[0][i].san_di,type[0][i].san_xie,sun_width,sun_height,"rgb(150, 215, 21)","stroke");draw_sanjiao(type[0][i].id+1,san_arr_c[i],type[0][i].san_di,type[0][i].san_xie,sun_width,sun_height,"rgb(150, 215, 21)","stroke");var count_r=0,count_c=0;for(var k=0;k<san_arr_r[i].length;k++){count_r+=san_arr_r[i][k]}for(var k=0;k<san_arr_c[i].length;k++){count_c+=san_arr_c[i][k]}$(".info").eq(type[0][i].id).html("组件横放,底边:"+type[0][i].san_di+"米,斜边"+type[0][i].san_xie+"米,共："+count_r+"片 .");$(".info").eq(type[0][i].id+1).html("组件纵放,底边:"+type[0][i].san_di+"米,斜边"+type[0][i].san_xie+"米,共："+count_c+"片 .")}else{alert("不组成三角形！")}}for(var i=0;i<type[1].length;i++){if(parseInt(type[1][i].ti_bottom)>parseInt(type[1][i].ti_top)&&parseInt(type[1][i].ti_xie)!=0&&(2*parseInt(type[1][i].ti_xie)+parseInt(type[1][i].ti_top))>parseInt(type[1][i].ti_bottom)){draw_tixing(type[1][i].id,parseInt(type[1][i].ti_top),parseInt(type[1][i].ti_bottom),parseInt(type[1][i].ti_xie),sun_width,sun_height,ti_arr_r[i],"rgb(150, 215, 21)","stroke");draw_tixing(type[1][i].id+1,parseInt(type[1][i].ti_top),parseInt(type[1][i].ti_bottom),parseInt(type[1][i].ti_xie),sun_width,sun_height,ti_arr_c[i],"rgb(150, 215, 21)","stroke");var count_r=0,count_c=0;for(var k=0;k<ti_arr_r[i].length;k++){count_r+=ti_arr_r[i][k]}for(var k=0;k<ti_arr_c[i].length;k++){count_c+=ti_arr_c[i][k]}$(".info").eq(type[1][i].id).html("组件横放,上边:"+type[1][i].ti_top+"米,下底:"+type[1][i].ti_bottom+"米 ,斜边："+type[1][i].ti_xie+"米 ,共："+count_r+"片 .");$(".info").eq(type[1][i].id+1).html("组件纵放,上边:"+type[1][i].ti_top+"米,下底:"+type[1][i].ti_bottom+"米 ,斜边："+type[1][i].ti_xie+"米 ,共："+count_c+"片 .")}else{if(parseInt(type[1][i].ti_bottom)<parseInt(type[1][i].ti_top)&&parseInt(type[1][i].ti_xie)!=0&&(2*parseInt(type[1][i].ti_xie)+parseInt(type[1][i].ti_top))>parseInt(type[1][i].ti_bottom)){alert("下底应大于上底！")}else{alert("不组成梯形！")}}}for(var i=0;i<type[2].length;i++){if((type[2][i].ju_width!=0&&type[2][i].ju_height!=0)){draw_juxing(type[2][i].id,ju_arr_r[i],parseInt(type[2][i].ju_width),parseInt(type[2][i].ju_height),sun_width,sun_height,"rgb(150, 215, 21)","stroke");draw_juxing(type[2][i].id+1,ju_arr_c[i],parseInt(type[2][i].ju_width),parseInt(type[2][i].ju_height),sun_width,sun_height,"rgb(150, 215, 21)","stroke");var count_r=0,count_c=0;count_r=ju_arr_r[i][0]*ju_arr_r[i][1];count_c=ju_arr_c[i][0]*ju_arr_c[0][1];$(".info").eq(type[2][i].id).html("组件横放,底边:"+type[2][i].ju_width+"米,高:"+type[2][i].ju_height+"米,共："+count_r+"片 .");$(".info").eq(type[2][i].id+1).html("组件纵放,底边:"+type[2][i].ju_width+"米,高:"+type[2][i].ju_height+"米,共："+count_c+"片 .")}else{alert("不组成矩形")}}if($("#rectangle").prop("checked")==false&&$("#trapezoid").prop("checked")==false&&$("#triangle").prop("checked")==false){alert("请选择类型！")}});function create_node(){for(var i=0;i<2;i++){var canvas_obj='<canvas  class="canvas" width="100" height="100"></canvas><p class="info"></p>';$(".canvas-content").append(canvas_obj);$(".canvas").attr("width",$(".canvas-content").width());$(".canvas").attr("height",$(".canvas").width());canvas_length=$(".canvas-content").children("canvas").length}}function draw_juxing(i,arr,width,height,sun_width,sun_height,color,type){var canvas=document.getElementsByClassName("canvas")[i];if(canvas.getContext){var ctx=canvas.getContext("2d");var canvas_width=$(".canvas").eq(i).width();var canvas_height=$(".canvas").eq(i).height();var scale=width/(canvas_width-2);var _width=width/scale;var _height=height/scale;$(".canvas").eq(i).attr("height",_height);canvas_width=$(".canvas").eq(i).width();canvas_height=$(".canvas").eq(i).height();var x=(canvas_width-width/scale)/2;var y=canvas_height-height/scale;ctx[type+"Style"]=color;ctx.strokeRect(x,y+2,_width,_height-2);ctx.closePath();ctx[type]();if(i%2==0){var left_width=(width-sun_width*parseInt(arr[0]))/2;for(var i=0;i<parseInt(arr[1]);i++){for(var j=0;j<parseInt(arr[0]);j++){if(arr[0]>=2){ctx.beginPath();ctx.strokeRect(left_width/scale+sun_width/scale*j,(_height-sun_height/scale*i-sun_height/scale),sun_width/scale,sun_height/scale);ctx.closePath()}}}}else{var left_width=(width-sun_height*parseInt(arr[0]))/2;for(var i=0;i<parseInt(arr[1]);i++){for(var j=0;j<parseInt(arr[0]);
j++){if(arr[0]>=2){ctx.beginPath();ctx.strokeRect(left_width/scale+sun_height/scale*j,(_height-sun_width/scale*i-sun_width/scale),sun_height/scale,sun_width/scale);ctx.closePath()}}}}}}function jisuan_juxing(k,width,height,sun_width,sun_height){length_r=0;length_c=0;var sun_heightount_r=width/sun_width;var sun_widthount_r=height/sun_height;ju_arr_r[k]=[parseInt(sun_heightount_r),parseInt(sun_widthount_r)];var sun_heightount_c=width/sun_height;var sun_widthount_c=height/sun_width;ju_arr_c[k]=[parseInt(sun_heightount_c),parseInt(sun_widthount_c)]}var _sun_height,_sun_width;function draw_sanjiao(i,arr,di,xie,sun_width,sun_height,color,type){var x1,y1,x2,y2,x3,y3;var canvas=document.getElementsByClassName("canvas")[i];if(canvas.getContext){var ctx=canvas.getContext("2d");ctx.save();var canvas_width=$(".canvas").eq(i).width();var canvas_height=$(".canvas").eq(i).height();var scale=di/(canvas_width-2);var height=Math.sqrt(Math.pow(xie,2)-Math.pow((di/2),2));var _height=height/scale;var cos=(di/2)/xie;var sin=Math.sqrt(1-Math.pow(cos,2));var tan=sin/cos;_sun_height=sun_width/tan;_sun_width=sun_height/tan;$(".canvas").eq(i).attr("height",_height);canvas_width=$(".canvas").eq(i).width();canvas_height=$(".canvas").eq(i).height();x1=(canvas_width-di/scale)/2;y1=canvas_height;x2=x1+di/scale;y2=canvas_height;x3=canvas_width/2;y3=canvas_height-height/scale;ctx.beginPath();ctx.moveTo(x1,y1-1);ctx.lineTo(x2,y2-1);ctx.lineTo(x3,y3);ctx[type+"Style"]=color;ctx.closePath();ctx[type]();ctx.restore();ctx.beginPath();var left_width=0,first_width=0;if(i%2==0){for(var i=0;i<arr.length;i++){if(i==0){first_width=(di-arr[0]*sun_width)/2;left_width=first_width}else{left_width=((arr[0]-arr[i])/2)*sun_width+first_width}for(var j=0;j<arr[i];j++){ctx.strokeRect((left_width/scale)+sun_width/scale*j,(_height-sun_height/scale*i-sun_height/scale),sun_width/scale,sun_height/scale)}}}else{for(var i=0;i<arr.length;i++){if(i==0){first_width=(di-arr[0]*sun_height)/2;left_width=first_width}else{left_width=((arr[0]-arr[i])/2)*sun_height+first_width}for(var j=0;j<arr[i];j++){ctx.strokeRect((left_width/scale)+sun_height/scale*j,(_height-sun_width/scale*i-sun_width/scale),sun_height/scale,sun_width/scale)}}}ctx[type+"Style"]=color;ctx.closePath();ctx[type]();ctx.restore()}}function jisuan_sanjiao(k,san_xie,san_di,sun_width,sun_height){var height=Math.sqrt(Math.pow(san_xie,2)-Math.pow((san_di/2),2));var cos=(san_di/2)/san_xie;var sin=Math.sqrt(1-Math.pow(cos,2));var tan=sin/cos;_sun_height=sun_width/tan;var _sun_width=parseInt(height/sun_width);var _sun_width_z=sun_height*tan;var _count_c=(height-_sun_width_z)/sun_width;for(var i=1;i<_count_c+1;i++){if((san_di-i*_sun_height*2)>=(2*sun_height)){san_arr_c[k].push(parseInt((san_di-i*_sun_height*2)/sun_height))}}_sun_width=sun_height/tan;var _sun_height=parseInt(height/sun_height);var _sun_height_z=sun_width*tan;var _count_r=(height-_sun_height_z)/sun_height;for(var i=1;i<_count_r+1;i++){if((san_di-i*_sun_width*2)>=(2*sun_width)){san_arr_r[k].push(parseInt((san_di-i*_sun_width*2)/sun_width))}}}function draw_tixing(i,top_di,bottom_di,xie,sun_width,sun_height,arr,color,type){var x1,y1,x2,y2,x3,y3,x4,y4;var canvas=document.getElementsByClassName("canvas")[i];if(canvas.getContext){var ctx=canvas.getContext("2d");var canvas_width=$(".canvas").eq(i).width();var height=Math.sqrt(Math.pow(xie,2)-Math.pow(((bottom_di-top_di)/2),2));var canvas_height=$(".canvas").eq(i).height();var scale=bottom_di/canvas_width;var _height=height/scale;$(".canvas").eq(i).attr("height",_height);canvas_width=$(".canvas").eq(i).width();canvas_height=$(".canvas").eq(i).height();x1=(canvas_width-bottom_di/scale)/2;y1=canvas_height;x2=x1+bottom_di/scale;y2=canvas_height;x3=x1+(bottom_di/scale-top_di/scale)/2+top_di/scale;y3=canvas_height-height/scale;x4=x1+(bottom_di/scale-top_di/scale)/2;y4=y3;ctx.beginPath();ctx.moveTo(x1,y1-1);ctx.lineTo(x2,y2-1);ctx.lineTo(x3,y3+1);ctx.lineTo(x4,y4+1);ctx[type+"Style"]=color;ctx.closePath();ctx[type]();ctx.beginPath();arr.sort(function(x,y){return y-x});var left_width=0,first_width=0;if(i%2==0){for(var i=0;i<arr.length;i++){if(i==0){first_width=(bottom_di-arr[0]*sun_width)/2;left_width=first_width}else{left_width=((arr[0]-arr[i])/2)*sun_width+first_width}for(var j=0;j<arr[i];j++){ctx.strokeRect((left_width/scale)+sun_width/scale*j,(canvas_height-sun_height/scale*i-sun_height/scale),sun_width/scale,sun_height/scale)}}}else{for(var i=0;i<arr.length;i++){if(i==0){first_width=(bottom_di-arr[0]*sun_height)/2;left_width=first_width}else{left_width=((arr[0]-arr[i])/2)*sun_height+first_width}for(var j=0;j<arr[i];j++){ctx.strokeRect((left_width/scale)+sun_height/scale*j,(canvas_height-sun_width/scale*i-sun_width/scale),sun_height/scale,sun_width/scale)}}}ctx[type+"Style"]=color;ctx.closePath();ctx[type]()}}function jisuan_tixing(k,ti_top,ti_bottom,ti_xie,sun_width,sun_height){var ti_height=Math.sqrt(Math.pow(ti_xie,2)-Math.pow(((ti_bottom-ti_top)/2),2));var ti_tan=ti_height/((ti_bottom-ti_top)/2);console.log(ti_height);
var ti_left_r=sun_height/ti_tan;var count_r=ti_height/sun_height;for(var i=1;i<=count_r;i++){if((ti_bottom-2*ti_left_r*i)>(2*sun_width)){ti_arr_r[k].push(parseInt((ti_bottom-2*ti_left_r*i)/sun_width))}}var ti_left_c=sun_width/ti_tan;var count_c=ti_height/sun_width;for(var i=1;i<=count_c;i++){if((ti_bottom-2*ti_left_r*i)>(2*sun_width)){ti_arr_c[k].push(parseInt((ti_bottom-2*ti_left_c*i)/sun_height))}}console.log(ti_arr_r);console.log(ti_arr_c)}function downloadImage(canvas){var type="png";var imgData=canvas.toDataURL(type);var _fixType=function(type){type=type.toLowerCase().replace(/jpg/i,"jpeg");var r=type.match(/png|jpeg|bmp|gif/)[0];return"image/"+r};var saveFile=function(data,filename){var save_link=document.createElementNS("http://www.w3.org/1999/xhtml","a");save_link.href=data;save_link.download=filename;var event=document.createEvent("MouseEvents");event.initMouseEvent("click",true,false,window,0,0,0,0,0,false,false,false,false,0,null);save_link.dispatchEvent(event)};var filename="baidufe_"+(new Date()).getTime()+"."+type;saveFile(imgData,filename);imgData=imgData.replace(_fixType(type),"image/octet-stream")}});